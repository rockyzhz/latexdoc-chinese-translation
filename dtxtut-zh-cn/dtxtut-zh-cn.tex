% !TEX program = xelatex
%%% ====================================================================
%%%  @LaTeX-file{
%%%     author          = "Scott Pakin",
%%%     version         = "2.1",
%%%     date            = "13 September 2015",
%%%     time            = "23:06:32 MDT",
%%%     filename        = "dtxtut.tex",
%%%     checksum        = "38789 2107 7734 71546"
%%%     email           = "scott+dtx@pakin.org (Internet)",
%%%     codetable       = "ISO/ASCII",
%%%     keywords        = "LaTeX, packages, .ins files, .dtx files,
%%%                        literate programming",
%%%     supported       = "yes",
%%%     abstract        = "This tutorial is intended for advanced
%%%                        LaTeX 2e users who want to learn how to
%%%                        create .ins and .dtx files for distributing
%%%                        their homebrewed classes and style files.",
%%%     docstring       = "The checksum field above contains a CRC-16
%%%                        checksum as the first value, followed by
%%%                        the equivalent of the standard UNIX wc
%%%                        (word count) utility output of lines,
%%%                        words, and characters.  This is produced by
%%%                        Robert Solovay's checksum utility.  This file
%%%                        header was produced with the help of Nelson
%%%                        Beebe's filehdr utility.  Both checksum and
%%%                        filehdr are available from CTAN
%%%                        (http://www.ctan.org)."
%%%
%%%  }
%%% ====================================================================

\PassOptionsToPackage{quiet}{fontspec}
\documentclass[11pt]{ltxguide}
\usepackage{varioref}
\usepackage{makeidx}
\usepackage{alltt}
\usepackage{tocbibind}
\usepackage[bookmarksopen]{hyperref}
\usepackage{hyperxmp}

% Chinese version settings
\usepackage{xeCJK}
\setCJKmainfont {SourceHanSerifSC}
[
  Extension   = .otf,
  UprightFont = *-regular,
  BoldFont    = *-Bold,
  ItalicFont  = FandolKai-Regular
]
\setCJKsansfont {SourceHanSansSC}
[
  Extension   = .otf,
  UprightFont = *-regular,
  BoldFont    = *-Bold
]
\setCJKmonofont {FandolKai}
[
  Extension   = .otf,
  UprightFont = *-regular
]
\usepackage{zhnumber,zhspacing}
\usepackage{enumitem}
\renewcommand{\abstractname}{摘\quad 要}
\renewcommand{\refname}{参考文献}
\renewcommand{\indexname}{索引}
\renewcommand{\clsguide}{面向宏包与类文件编写者的\ \LaTeXe}
\setlength{\parindent}{2em}
\usepackage{indentfirst}
\linespread{1.242} 
\usepackage{xcolor}
\definecolor{spot}{HTML}{003399}
\definecolor{code}{HTML}{a25e26}
\definecolor{verb}{HTML}{007f00}
\AtBeginEnvironment{decl}{\color{spot}}
\AtBeginEnvironment{verbatim}{\color{verb}}
\AtBeginEnvironment{alltt}{\color{verb}}
\hypersetup{%
  colorlinks=true,
  linkcolor=spot,
  urlcolor=spot,
  citecolor=spot,
  bookmarksopen=false,
  bookmarksnumbered=false,
  plainpages=false,
  pdfview=FitH}

% Define this document's metadata.
\title{\huge\bfseries\color{spot}如何打包你的 \LaTeX{} 宏包}
\author{Scott Pakin \texttt{<scott+dtx@pakin.org>}}
\date{\parbox{\linewidth}{\centering 13 September 2015
      \\[.5cm]张泓知\qquad 翻译\\[.3cm]\zhtoday}}
\hypersetup{%
  pdftitle={How to Package Your LaTeX Package},
  pdfauthor={Scott Pakin},
  pdfcontactemail={scott+dtx@pakin.org},
  pdfcontacturl={http://www.pakin.org/\xmptilde scott},
  pdfsubject={Writing .ins and .dtx files for LaTeX},
  pdfkeywords={LaTeX package documentation, literate programming, typesetting, installer files},
  pdfcaptionwriter={Scott Pakin},
  pdfcopyright={Copyright (C) 2015 Scott Pakin},
  pdflicenseurl={http://latex-project.org/lppl/},
  pdflang={en-US}
}

% Define a term.
\newcommand{\defn}[2][X]{%
  \ifx#1X
    \emph{#2}\index{#2}%
  \else
    \emph{#2}\index{#1}%
  \fi
}

% Make a version of \dots that allows a subsequent line break.
\newcommand{\dotsbrk}{\dots\linebreak[0]}

% If we have url.sty loaded, use that for formatting URLs.
\ifx\url\undefined
\else
  \let\URL=\url
\fi

% Define formatting for various packages.
\newcommand{\DOC}{\textsf{Doc}\index{Doc@\textsf{Doc}}}
\newcommand{\ds}{\textsf{DocStrip}\index{DocStrip@\textsf{DocStrip}}}
\newcommand{\svrb}{\texttt{shortvrb}\index{shortvrb@\texttt{shortvrb}}}

% Customize varioref's messages.
\def\reftextbefore{on the preceding page}
\def\reftextfacebefore{on the preceding page}
\def\reftextcurrent{above}   % We promise not to make any forward references.

% Define some macros to help automate indexing.
\makeindex
{\catcode`\|=0 \catcode`\\=12
 |gdef|bslash{\}}
\newcommand{\defmacro}[1]{%                   % Define a macro.
  \texttt{\bslash#1}%
  \index{#1@\texttt{\string\bslash{}#1}}%
}
\newcommand{ \usemacro}[1]{%                   % Use a macro.
  \texttt{\bslash#1}%
  \index{#1@\texttt{\string\bslash{}#1}}%
}
\newcommand{\indexmacro}[1]{%                 % Index a macro (no display).
  \index{#1@\texttt{\string\bslash{}#1}}%
}
{\catcode`\|=12                               % Same as \indexmacro, but
  \gdef\indexmacroBegin#1{%                   % for ranges of text
    \index{#1@\texttt{\string\bslash{}#1}|(}%
  }
  \gdef\indexmacroEnd#1{%
    \index{#1@\texttt{\string\bslash{}#1}|)}%
  }
}
\newcommand{\defthing}[1]{%                   % Define a non-macro thing.
  \texttt{#1}%
  \index{#1@\texttt{#1}}%
}
\newcommand{\usething}[1]{%                   % Use a non-macro thing.
  \texttt{#1}%
  \index{#1@\texttt{#1}}%
}
\newcommand{\indexthing}[1]{%                 % Index a non-macro thing.
  \index{#1@\texttt{#1}}%
}
{\catcode`\|=12                               % Same as \indexthing, but
  \gdef\indexthingBegin#1{%                   % for ranges of text
    \index{#1@\texttt{#1}|(}%
  }
  \gdef\indexthingEnd#1{%
    \index{#1@\texttt{#1}|)}%
  }
}

% Define shortcuts to index commonly used terms.
\newcommand{\insfile}{%
  \texttt{.ins}\index{installer file}}
\newcommand{\dtxfile}{%
  \texttt{.dtx}\index{documented LaTeX file@documented \string\LaTeX{} file}}
\newcommand{\styfile}{%
  \texttt{.sty}\index{style file}}
\newcommand{\clsfile}{%
  \texttt{.cls}\index{class file}}
\newcommand{\CTAN}{%
  CTAN\index{Comprehensive \string\TeX{} Archive Network}}
\newcommand{\swiftexel}{%
  \texttt{swiftex.el}\index{swiftex.el@\texttt{swiftex.el}}}
\newcommand{\Emacs}{%
  Emacs\index{Emacs}}
\newcommand{\latex}[1][\LaTeX]{%
  #1\index{LaTeX@\LaTeX}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\sloppy
\maketitle

\begin{abstract}
  本教程适用于那些希望学习如何创建 \insfile{} 和 \dtxfile{} 文件，
  以便分发他们自己编写的类和样式文件的高级 \latex[\LaTeXe]{} 用户。
\end{abstract}


\section{介绍}

\paragraph{要求}
我们假设您已经了解如何在 \latex\@ 中\emph{编程}。
也就是说，您应该知道如何使用 \usemacro{newcommand}、
\usemacro{newenvironment}，最好还懂一点 \TeX\@。
您还应该熟悉《\clsguide》，它可以在 \CTAN{}
(\URL{http://www.ctan.org}) 上获取，并且大多数
\latex[\LaTeXe]{} 发行版中都包含一个名为 |clsguide.dvi| 的文件。
最后，您应该知道如何安装由 \dtxfile{} 文件和 \insfile{} 文件
组成的软件包\index{package}。

\index{package|(}
\paragraph{术语}
一个\defn[style file]{宏包\textnormal{（ \styfile{}）}文件}主要是一组宏和环境的定义。
一个或多个样式文件（例如一个主样式文件， \usemacro{input} 或 \usemacro{RequirePackage}
多个辅助文件）称为一个\defn{package}。包可以用 \usemacro{usepackage}|{<main .sty file>}|
\index{style file}载入文档中。在本文档的其余部分，我们使用符号“\m{package}”
代表您的包的名称。\index{package|)}

\paragraph{动机}
一个包\index{package}的重要部分包括代码、代码的文档和用户文档。
使用 \DOC{} 和 \ds{} 程序，可以将这三者合并为一个单一的，带有说明的
\defn[documented LaTeX file@documented \string\LaTeX{} file]{说明 \LaTeX{}
  \textnormal{（ \dtxfile{}）}文件}。 \dtxfile{}文件的主要优势在于，
它允许您使用任意的 \latex{} 构造来注释\index{comments}您的代码。
因此，宏、环境、代码段、变量等都可以使用表格、图形、数学公式和字体变化来解释。
代码可以使用 \latex 的分段命令进行组织。\index{indexing|(}
\DOC{}甚至可以生成一个统一的索引，对宏定义（在 \latex{} 代码中）和
宏描述（在用户文档中）进行索引。\index{indexing|)}
这种注重为代码编写详细的、漂亮排版的注释\index{comments}的方法——
本质上将程序视为描述一组算法的书——被称为\defn{文学编程}~\cite{Knuth1984:literate}，
并自早期的 \TeX{} 开始就被使用。

本教程将教您如何编写基本的 \dtxfile{} 文件和操作它们的 \insfile{} 文件。
虽然与《 \latex{} Companion》的第14章存在许多重叠~\cite{Goossens1994:companion}，
但本文档结构更像是一步一步的教程，而《 \latex{} Companion》更像是参考资料。
此外，本教程展示了如何编写一个单一文件，既作为文档又作为驱动文件，
这是 \DOC{} 系统的一种更典型的用法，而不是使用分开的文件。


\index{installer file|(}

\section{\texttt{.ins} 文件}
\label{sec:ins-file}

为了准备一个包用于发布，第一步是编写一个\defn[installer file]{安装\textnormal{（ \insfile{}）}文件}。
安装文件从 \dtxfile{} 文件中提取代码，
使用 \ds{} 去掉注释\index{comments}和文档，然后输出一个 \styfile{} 文件。
好消息是， \insfile{} 文件通常相当简短，并且在一个包\index{package}到另一个
包之间没有明显变化。

\index{license|(}
\insfile{} 文件通常以注释\index{comments}开始，指定版权\index{copyright}
和许可信息：

\begin{verbatim}
    %%
    %% Copyright (C) <year> by <your name>
    %%
    %% This file may be distributed and/or modified under the
    %% conditions of the LaTeX Project Public License, either
    %% version 1.3 of this license or (at your option) any later
    %% version.  The latest version of this license is in:
    %%
    %%    http://www.latex-project.org/lppl.txt
    %%
    %% and version 1.3 or later is part of all distributions of
    %% LaTeX version 2005/12/01 or later.
    %%
\end{verbatim}

\noindent
\index{package|(}

\latex{} 项目公共许可证\index{LaTeX Project Public License@\LaTeX{} 项目公共
  许可证}（LPPL）是大多数包——以及 \latex{} 本身——所使用的许可证。当然，
您可以根据您想要的任何许可证发布您的包；LPPL 只是 \latex{} 包中最常见的
许可证。LPPL 规定用户可以对您的包做任何事情——包括出售它，并且无需向您
支付任何费用。唯一的限制是他必须为您的工作给予您信用，并且如果他修改了
任何内容以避免版本混淆，他必须更改包的名称。
\index{package|)}
\index{license|)}
\index{LPPL|see{\LaTeX{} Project Public License}}

下一步是加载 \ds:

\begin{verbatim}
    \input docstrip.tex
\end{verbatim}


\indexmacroBegin{keepsilent} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{keepsilent}
\end{decl}

默认情况下，\ds{} 会详细列出其活动情况。这些消息并不是特别有用，
所以大多数人会将其关闭：

\begin{verbatim}
    \keepsilent
\end{verbatim}

\indexmacroEnd{keepsilent}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{usedir} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{usedir} \arg{directory}
\end{decl}

系统管理员可以指定所有与 \TeX{} 相关文件应安装在其下的基本目录，
例如 |/usr/share/texmf|。（请参阅 \ds{} 手册中的“ \usemacro{BaseDirectory}”。）
\insfile{} 文件指定其文件相对于该目录应安装的位置。以下是典型的设置：

\begin{verbatim}
    \usedir{tex/latex/<package>}
\end{verbatim}

\indexmacroEnd{usedir}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{preamble} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{endpreamble}

\begin{decl}
  \defmacro{preamble}    \\
  \m{text}               \\
  \defmacro{endpreamble}
\end{decl}

\index{comments|(}
接下来的步骤是指定一个\defn{preamble}，即将写入到每个生成文件顶部的一段注释：

\begin{verbatim}
    \preamble

    This is a generated file.

    Copyright (C) <year> by <your name>

    This file may be distributed and/or modified under the
    conditions of the LaTeX Project Public License, either
    version 1.3 of this license or (at your option) any later
    version.  The latest version of this license is in:

       http://www.latex-project.org/lppl.txt

    and version 1.3 or later is part of all distributions of
    LaTeX version 2005/12/01 or later.

    \endpreamble
\end{verbatim}

\index{comments|)}

\noindent
前述的前言会导致 |<package>.sty|\index{style file} 文件开头如下：

\begin{verbatim}
    %%
    %% This is file `<package>.sty',
    %% generated with the docstrip utility.
    %%
    %% The original source files were:
    %%
    %% <package>.dtx  (with options: `package')
    %%
    %% This is a generated file.
    %%
    %% Copyright (C) <year> by <your name>
    %%
    %% This file may be distributed and/or modified under the
    %% conditions of the LaTeX Project Public License, either
    %% version 1.3 of this license or (at your option) any later
    %% version.  The latest version of this license is in:
    %%
    %%    http://www.latex-project.org/lppl.txt
    %%
    %% and version 1.3 or later is part of all distributions of
    %% LaTeX version 2005/12/01 or later.
    %%
\end{verbatim}

\indexmacroEnd{endpreamble}
\indexmacroEnd{preamble}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{generate} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{file}
\indexmacroBegin{from}

\begin{decl}
  \defmacro{generate}
  |{|\defmacro{file} |{<style-file>}|
  |{|\defmacro{from} |{<dtx-file>}| |{<tag>}}}|
\end{decl}

现在我们来到一个 \insfile{}文件中最重要的部分：指定从 \dtxfile{}文件生成哪些文件。
以下告诉 \ds{} 从 |<package>.dtx| 中仅提取标记为“|package|”的部分，
生成 |<package>.sty|\index{style file}。（如何标记 \dtxfile{} 文件的部分在第~\ref{sec:dtx-file}节中描述。）

\label{code:generate}
\begin{verbatim}
    \generate{\file{<package>.sty}{\from{<package>.dtx}{package}}}
\end{verbatim}%
\index{style file}

\usemacro{generate} 可以从给定的 \dtxfile{} 文件中提取任意数量的文件。
它甚至可以从多个 \dtxfile{} 文件中提取单个文件。详细信息请参阅 \ds{} 手册。

\indexmacroEnd{from}
\indexmacroEnd{file}
\indexmacroEnd{generate}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{Msg} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{Msg} \arg{text}
\end{decl}

\insfile{} 文件的下一部分包括命令，用于向用户输出消息，告诉他需要安装哪些文件，
并提醒他如何生成用户文档。以下一组 \usemacro{Msg} 命令是典型的：

\begin{verbatim}
    \obeyspaces
    \Msg{****************************************************}
    \Msg{*                                                  *}
    \Msg{* To finish the installation you have to move the  *}
    \Msg{* following file into a directory searched by TeX: *}
    \Msg{*                                                  *}
    \Msg{*     <package>.sty                                 *}
    \Msg{*                                                  *}
    \Msg{* To produce the documentation run the file        *}
    \Msg{* <package>.dtx through LaTeX.                      *}
    \Msg{*                                                  *}
    \Msg{* Happy TeXing!                                    *}
    \Msg{*                                                  *}
    \Msg{****************************************************}
\end{verbatim}%
\index{style file}%

\indexmacroEnd{Msg}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

请注意使用 \usemacro{obeyspaces} 来阻止 \TeX{} 合并多个空格为一个。

\indexmacroBegin{endbatchfile} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \usemacro{endbatchfile}
\end{decl}

最后，我们告诉 \ds{} 已经到达 \insfile{} 文件的末尾：

\begin{verbatim}
    \endbatchfile
\end{verbatim}

\indexmacroEnd{endbatchfile}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


附录~\ref{sec:skeleton-ins-file-style} 列出了一个完整的 \insfile{} 框架文件。
附录~\ref{sec:skeleton-ins-file-class} 类似，但包含了一些微小的修改，旨在生成
一个类（ \clsfile）文件，而不是样式（ \styfile）文件。

\index{installer file|)}
\index{documented LaTeX file@documented \LaTeX{} file|(}


\section{\texttt{.dtx} 文件}
\label{sec:dtx-file}

\index{package|(}
一个 \dtxfile{} 文件包含了包的有注释源代码和用户文档。通过运行 |latex| 命令来处理
一个 \dtxfile{} 文件，可以排版出用户文档，通常还包括一个漂亮排版的有注释\index{comments}
源代码版本。
\index{package|)}

由于一些 \DOC{} 的技巧，一个 \dtxfile{} 文件实际上被评估了\emph{两次}。
第一次，只评估了一小部分 \latex{} 驱动代码。第二次，\emph{comments}\index{comments}
在 \dtxfile{} 文件中被评估，就好像它们前面没有 ``|%|''。这可能会导致写 \dtxfile{}
文件时产生许多混乱，并偶尔导致一些笨拙的构造。幸运的是，一旦 \dtxfile{} 文件的基本结构
就位，填写代码就相当简单。


\subsection{序言}

\index{comments|(}

\dtxfile{} 文件通常以版权\index{copyright}和许可\index{license}的注释开始：

\begin{verbatim}
    % \iffalse meta-comment
    %
    % Copyright (C) <year> by <your name>
    %
    % This file may be distributed and/or modified under the
    % conditions of the LaTeX Project Public License, either
    % version 1.3 of this license or (at your option) any later
    % version.  The latest version of this license is in:
    %
    %    http://www.latex-project.org/lppl.txt
    %
    % and version 1.3 or later is part of all distributions of
    % LaTeX version 2005/12/01 or later.
    %
    % \fi
\end{verbatim}

\index{comments|)}

由于第二次处理 \dtxfile{} 文件时，行首的 |%| 字符会被忽略，所以需要使用
\usemacro{iffalse} 和 |\fi|。为了防止版权\index{copyright}/
许可\index{license}被解释为 \latex{} 代码，我们必须将其用 \usemacro{iffalse}\dotsbrk|\fi|
括起来。在“ \usemacro{iffalse}”后添加“\usething{meta-comment}”只是一种约定，
表示这个注释\index{comments}是为人类阅读而非 \DOC{}、\ds{} 或 \latex{} 的。

\indexmacroBegin{NeedsTeXFormat} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{ProvidesPackage}

\begin{decl}
  \defmacro{NeedsTeXFormat}  \arg{format-name} \oarg{release-date} \\
  \defmacro{ProvidesPackage} \arg{package-name} \oarg{release-info}
\end{decl}

接下来的几行同样被 \usemacro{iffalse}\dotsbrk|\fi|包围，以防止在第二次
通过 \dtxfile{} 文件时被 |latex| 处理。不过，这些行不是为人类读者准备的，
而是为了 \ds{} （因此没有“\usething{meta-comment}”）：

\label{code:ProvidesPackage}
\begin{verbatim}
    % \iffalse
    %<<package>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
    %<<package>>\ProvidesPackage{<package>}
    %<<package>>   [<YYYY>/<MM>/<DD> v<version> <description>]
    %
\end{verbatim}%
\indexmacro{NeedsTeXFormat}%
\indexmacro{ProvidesPackage}

\noindent
（我们很快就会遇到 |\fi|。）

还记得 \insfile{} 文件（第 \pageref{code:generate} 页）中的 \usemacro{generate} 行吗？
它以标签“|package|”结束。这告诉 \ds{} 将以“|%<<package>>|”开头的行写入到
\styfile{} 文件中，并在此过程中剥离“|%<<package>>|”。因此，我们的 \styfile{} 文件
将以以下内容开头：

\begin{verbatim}
    \NeedsTeXFormat{LaTeX2e}[2005/12/01]
    \ProvidesPackage{<package>}
       [<YYYY>/<MM>/<DD> v<version> <description>]
\end{verbatim}%
\indexmacro{NeedsTeXFormat}%
\indexmacro{ProvidesPackage}

比如：

\begin{verbatim}
    \NeedsTeXFormat{LaTeX2e}[2005/12/01]
    \ProvidesPackage{skeleton}
       [2002/03/25 v1.0 .dtx skeleton file]
\end{verbatim}%
\label{code:ProvidesPackage-example}%
\indexmacro{NeedsTeXFormat}%
\indexmacro{ProvidesPackage}

\index{package|(}
\usemacro{NeedsTeXFormat} 行确保该包不会在早于该包测试的 \latex[\LaTeXe]{} 版本下运行。
\usemacro{ProvidesPackage} 行中的日期和版本字符串用于由 \DOC{} 设置 \usemacro{filedate}
和 \usemacro{fileversion} 宏。请注意日期\index{date format}的格式：\emph{YYYY/MM/DD} 在
整个 \latex[\LaTeXe]{} 中都被使用，您的包中也应该使用这种格式。
\index{package|)}

\indexmacroEnd{ProvidesPackage}
\indexmacroEnd{NeedsTeXFormat}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{EnableCrossrefs} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{CodelineIndex}
\indexmacroBegin{RecordChanges}
\indexmacroBegin{DocInput}

\begin{decl}
  \defmacro{EnableCrossrefs} \\
  \defmacro{CodelineIndex}   \\
  \defmacro{RecordChanges}   \\
  \defmacro{DocInput} \arg{filename}   \label{desc:CodelineIndex}
\end{decl}

接下来是 \dtxfile{} 文件中唯一不被注释掉的部分（即每行不以 |%| 开头）：

\begin{verbatim}
    %<<*driver>>
    \documentclass{ltxdoc}
    \usepackage{<package>}
    \EnableCrossrefs
    \CodelineIndex
    \RecordChanges
    \begin{document}
      \DocInput{<package>.dtx}
    \end{document}
    %<</driver>>
    % \fi
\end{verbatim}

前述的代码块是 |latex| 在第一次处理 \dtxfile{} 文件时所评估的内容。
现在我们逐行来看这段代码：

\begin{enumerate}[itemindent=2em, left= 1.5em .. .5em]
  \item 将代码放置在“|%<<*driver>>|”和“|%<</driver>>|”之间是 \ds{} 的一种简写，
        表示在每一行前加上“|%<<driver>>|”。这标示了 \DOC{} 的驱动代码\index{driver code}。

  \item \usemacro{documentclass} 几乎总是应该使用 \usething{ltxdoc}，
        因为这会加载 \DOC{} 并提供一些有用的宏来格式化程序文档。

        \index{package|(}
  \item 您应该始终使用 \usemacro{usepackage} 导入您的包。如果不这样做，
        \DOC{} 将无法看到包的 \usemacro{ProvidesPackage} 行，
        并且不知道如何设置 \usemacro{filedate} 和 \usemacro{fileversion}
        （参见第~\pageref{code:GetFileInfo} 页）。这也是您应该在此处使用
        \usemacro{usepackage} 导入用于排版用户文档所需的其他任何包的地方。
        \index{package|)}

  \item \usemacro{EnableCrossrefs} 告诉 \DOC{} 您希望它为您的代码构建索引——通常是个好主意。
        另一种选择是 \usemacro{DisableCrossrefs}，它可以在处理速度上稍微提升一些，
        但影响微乎其微。

  \item \usemacro{CodelineIndex} 告诉 \DOC{} 索引应该引用程序行号而不是页码。
        （另一种选择是 \usemacro{PageIndex}。） \usemacro{CodelineIndex} 使得索引条目更易于查找，
        但以索引的自洽性稍有损失（因为宏和环境的描述总是按页码索引）。
        索引，不过，会以一条说明性的注释开始。

  \item \label{item:RecordChanges} 在第~\pageref{code:changes} 页，我们将看到如何记录
        包\index{package}每个版本的更改。 \usemacro{RecordChanges} 告诉 \DOC{} 应该保留并
        汇总日志条目。

  \item 在 |\begin{document}| 和 |\end{document}| 之间应该只有一个命令：
        一个 \usemacro{DocInput} 调用，用于 \dtxfile{} 文件自身的输入。
        这使得主文件可以通过 \usemacro{DocInput} 来输入多个文件，从而生成一个单一文档，
        涵盖了多个包\index{package}但包含了一个统一的索引\index{indexing}。
        主文档文件在第~\vpageref{sec:master-files} 页有描述。
\end{enumerate}

\indexmacroEnd{DocInput}
\indexmacroEnd{RecordChanges}
\indexmacroEnd{CodelineIndex}
\indexmacroEnd{EnableCrossrefs} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{OnlyDescription} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{OnlyDescription} \label{desc:OnlyDescription}
\end{decl}

在前言（即 |\begin{document}| 之前）有时会出现的另一个命令是 \usemacro{OnlyDescription}，
它告诉 \DOC{} 仅排版用户文档，而不是包\index{package}的代码或注释\index{comments}。
最好通常省略 \usemacro{OnlyDescription}（或将其注释掉）。用户始终可以手动添加它，
甚至可以通过将以下内容添加到他的 \defthing{ltxdoc.cfg} 文件中，为\emph{所有} \dtxfile{}
文件启用 \usemacro{OnlyDescription}：

\begin{verbatim}
     \AtBeginDocument{\OnlyDescription}
\end{verbatim}%
\indexmacro{AtBeginDocument}

\indexmacroEnd{OnlyDescription}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bigskip
本节剩余部分涵盖了 |latex| 对 \dtxfile{} 文件的第二次处理。
因此，所有随后的示例都以百分号开头。

\indexmacroBegin{CheckSum} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{checksumming|(}

\begin{decl}
  \defmacro{CheckSum} \arg{number} \label{decl:CheckSum}
\end{decl}

\DOC{} 支持一种非常简单的文档校验机制，以确保包\index{package}在传输过程中没有损坏。
\DOC{} 只是简单地计算代码中反斜杠的数量。如果数量与校验和匹配，\DOC{} 会给出一个成功的消息：

\begin{verbatim}
    *******************
    * Checksum passed *
    *******************
\end{verbatim}

否则，它会显示正确的校验和应该是多少：

\begin{verbatim}
    ! Package doc Error: Checksum not passed (<incorrect><<>><correct>).
\end{verbatim}%
\indexthing{Checksum not passed}

要在 \dtxfile{} 文件中指定校验和，只需添加一个 \usemacro{CheckSum} 语句：

\begin{verbatim}
    % \CheckSum{<number>}
\end{verbatim}

当 \m{number} 为 |0|，或者 \dtxfile{} 文件完全缺少 \usemacro{CheckSum} 行时，
\DOC{} 会输出以下警告消息：

\begin{verbatim}
    **********************************
    * This macro file has no checksum!
    * The checksum should be <number>!
    **********************************
\end{verbatim}

在代码开发过程中，指定 |\CheckSum{0}| 很方便，这样你每次运行 |latex| 时就不会收到错误消息。
但在发布你的包\index{package}之前，请不要忘记将“|0|”替换为正确的数字！

\index{checksumming|)}
\indexmacroEnd{CheckSum}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{CharacterTable} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{CharacterTable} \arg{text}
\end{decl}

\DOC{} 使用的第二种确保 \dtxfile{} 文件未损坏的机制是字符表。
\footnote{译者注：虽然 \texttt{\bslash CharacterTable} 和 \texttt{\bslash CheckSum} 在公共互联网早
  期是 \DOC{} 写作时的重要的特性，因为当时的邮件网关相当不可靠并经常搞乱文件，但在今天，它们更多的是一个
  麻烦而不是帮助。因此，它们现在是完全可选的，并且不建议在新文件中使用。}
如果你将以下命令原样放入你的 \dtxfile{} 文件中，\DOC{} 将确保在传输过
程中没有发生意外的字符转换：
\footnote{字符表通常以双百分号作为前
  缀，这样它会被写入 \texttt{.sty}\index{style file} 文件。这似乎
  是不必要的，因此此处用单百分号显示。}

\begin{verbatim}
    % \CharacterTable
    %  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
    %   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
    %   Digits        \0\1\2\3\4\5\6\7\8\9
    %   Exclamation   \!     Double quote  \"     Hash (number) \#
    %   Dollar        \$     Percent       \%     Ampersand     \&
    %   Acute accent  \'     Left paren    \(     Right paren   \)
    %   Asterisk      \*     Plus          \+     Comma         \,
    %   Minus         \-     Point         \.     Solidus       \/
    %   Colon         \:     Semicolon     \;     Less than     \<<
    %   Equals        \=     Greater than  \>>     Question mark \?
    %   Commercial at \@     Left bracket  \[     Backslash     \\
    %   Right bracket \]     Circumflex    \^     Underscore    \_
    %   Grave accent  \`     Left brace    \{     Vertical bar  \|
    %   Right brace   \}     Tilde         \~}
\end{verbatim}

成功消息的样式如下：

\begin{verbatim}
    ***************************
    * Character table correct *
    ***************************
\end{verbatim}

而错误消息的样式如下：

\begin{verbatim}
    ! Package doc Error: Character table corrupted.
\end{verbatim}%
\indexthing{Character table corrupted}

\indexmacroEnd{CharacterTable}     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{changes} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  \defmacro{changes} \arg{version} \arg{date} \arg{description}
  \label{code:changes}
\end{decl}

\index{package|(}

在第~\pageref{item:RecordChanges} 页我们了解到 \DOC{} 有一个记录
包变更的机制。命令是“|\changes{<version>}{<date>}{<description>}|”，
通常用 \usemacro{changes} 来记录包的初始版本和创建日期：

\index{package|)}

\begin{verbatim}
    % \changes{v1.0}{2002/03/25}{Initial version}
\end{verbatim}

\usemacro{changes} 命令的一个好处是它知道自己是在宏/环境定义的内
部使用还是顶层使用。如图~\ref{fig:change-history} 所示，顶层变更以
“General:”为前缀，而内部变更以包围它的宏或环境的名称为前缀。

\begin{figure}[htbp]
  \centering
  \index{change history}
  \fbox{%
    \begin{minipage}[t]{0.75\textwidth}
      {\normalfont\Large\bfseries Change History\vskip 2.3ex plus 0.2ex}
      v1.0 \\
      \hspace*{2em} General: Top-level comment \dotfill 1 \\
      v1.2j \\
      \hspace*{2em} \texttt{myMacro}: Internal macro comment \dotfill 5
    \end{minipage}%
  }%
  \caption{Sample change history}
  \label{fig:change-history}
\end{figure}

\indexmacroEnd{changes}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{GetFileInfo} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{filedate}
\indexmacroBegin{fileversion}
\indexmacroBegin{fileinfo}

\begin{decl}
  \defmacro{GetFileInfo} \arg{style-file}   \label{code:GetFileInfo} \\[1ex]
  \defmacro{filedate}    \\
  \defmacro{fileversion} \\
  \defmacro{fileinfo}
\end{decl}

接下来，我们告诉 \DOC{} 解析 \usemacro{ProvidesPackage} 命令
（第~\pageref{code:ProvidesPackage} 页），依次调用
\usemacro{ProvidesPackage} 参数的三个组成部分，
分别是“ \usemacro{filedate}”、“ \usemacro{fileversion}” 和
“ \usemacro{fileinfo}”：

\begin{verbatim}
    % \GetFileInfo{<package>.sty}
\end{verbatim}%
\index{style file}%
\indexmacro{GetFileInfo}

\noindent
例如， \usemacro{ProvidesPackage} 的示例
（见第~\vpageref{code:ProvidesPackage-example} 页）将被解析如下：

|    |%
\begin{tabular}{@{}l@{\qquad$\equiv$\qquad}l@{}}
  \usemacro{filedate}    & 2002/03/25         \\
  \usemacro{fileversion} & v1.0               \\
  \usemacro{fileinfo}    & .dtx skeleton file
\end{tabular}

\indexmacroEnd{fileinfo}
\indexmacroEnd{fileversion}
\indexmacroEnd{filedate}
\indexmacroEnd{GetFileInfo} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{DoNotIndex} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{indexing|(}

\begin{decl}
  \defmacro{DoNotIndex} \arg{macro-name \textnormal{, \dots}}
\end{decl}

在生成索引时，\DOC{} 通常会索引代码中的\emph{每个}控制序列（即反斜线开头的单词或符号）。
这种自动化水平的问题在于，许多控制序列在理解代码的角度来看并不重要。例如，读者
可能不想看到每个使用了 |\if|、|\the|、|\let|、|\begin| 或其他众多控制序列的地方。

正如其名称所示， \usemacro{DoNotIndex} 命令给出了一个\index{control sequences}
不应被索引的控制序列列表给 \DOC{}。 \usemacro{DoNotIndex} 可以使用任意次数，
并且每次调用可以接受任意数量的控制\index{control sequences}序列名称：

\begin{verbatim}
    % \DoNotIndex{\#,\$,\%,\&,\@,\\,\{,\},\^,\_,\~,\ }
    % \DoNotIndex{\@ne}
    % \DoNotIndex{\advance,\begingroup,\catcode,\closein}
    % \DoNotIndex{\closeout,\day,\def,\edef,\else,\empty,\endgroup}
\end{verbatim}
\centerline{$\vdots$}

\index{indexing|)}
\indexmacroEnd{DoNotIndex}     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{用户文档}

我们终于可以开始编写用户文档了。典型的开头如下：

\begin{verbatim}
    % \title{The \textsf{<package>} package\thanks{This document
    %   corresponds to \textsf{<package>}~\fileversion,
    %   dated~\filedate.}}
    % \author{<your name> \\ \texttt{<your e-mail address>}}
    %
    % \maketitle
\end{verbatim}%
\indexmacro{title}
\indexmacro{author}
\indexmacro{maketitle}

\index{package|(}
当然标题可以更有创意，但请注意，使用 \usemacro{textsf} 排版包名是常见的做法，而使用 \usemacro{thanks}
来指定包的版本和日期。这样做带来了文学化编程\index{literate programming}的一个优点：每当你改变包的版本
（作为 \usemacro{ProvidesPackage} 的可选第二参数），用户文档会相应更新。当然，你仍然需要手动确保用户文
档准确描述了更新后的包。
\index{package|)}

以你处理任何 \latex{} 文档的方式撰写用户文档，不过每行都要以 ``|%|'' 开头。请注意，\usething{ltxdoc} 
文档类派生自 |article|，因此顶级分段命令是 \usemacro{section}，而不是 \usemacro{chapter}。


\indexmacroBegin{DescribeMacro} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{DescribeEnv}

\begin{decl}
  \defmacro{DescribeMacro} \arg{macro} \\
  \defmacro{DescribeEnv} \arg{environment}
\end{decl}

\DOC{} 提供了一些命令来帮助格式化用户文档。如果你在段落中包含
``|\DescribeMacro{<macro>}|''\footnote{``\m{macro}'' 应包括反斜线。}，
\DOC{} 会将 ``\m{macro}'' 放在边距中，方便读者查看。同时，\DOC{} 还会将
\m{macro} 加入索引，并格式化相应的页码，以表明这是描述该宏的位置（而不是
宏在源代码中定义的地方）。

\usemacro{DescribeEnv} 是描述环境的类似命令。 \usemacro{DescribeMacro} 和
\usemacro{DescribeEnv} 都可以在同一段落中多次使用。

\indexmacroEnd{DescribeEnv}
\indexmacroEnd{DescribeMacro}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexmacroBegin{marg} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{oarg}
\indexmacroBegin{parg}
\indexmacroBegin{meta}

\begin{decl}
  \defmacro{marg} \arg{argument} \\
  \defmacro{oarg} \arg{argument} \\
  \defmacro{parg} \arg{argument} \\
  \defmacro{meta} \arg{text}
\end{decl}

\usething{ltxdoc} 文档类提供了三个命令来帮助排版宏和环境的语法
（见表~\ref{tbl:argument-formatting}）。 \usemacro{marg} 用于排版必选参数，
\usemacro{oarg} 用于排版可选参数， \usemacro{parg} 用于排版图片参数。
这三个命令都使用 \usemacro{meta} 来排版参数内容。 \usemacro{meta} 也可单独使用。
例如，“\texttt{This needs a} |\meta{dimen}|.” 会排版为“This needs a \m{dimen}.”。

\begin{table}[htbp]
  \centering
  \caption{Argument-formatting commands}
  \label{tbl:argument-formatting}
  \begin{tabular}{@{}ll@{}}
    \hline
    \multicolumn{1}{@{}c}{Command} &
    \multicolumn{1}{c@{}}{Result}               \\
    \hline
    \usemacro{marg}|{text}|        & |{<text>}| \\
    \usemacro{oarg}|{text}|        & |[<text>]| \\
    \usemacro{parg}|{text}|        & |(<text>)| \\
    \hline
  \end{tabular}
\end{table}

除了这些命令外，\DOC{} 通过自动加载 \svrb{} 包\index{package}，
便利地简化了宏描述的排版。\svrb{} 允许你使用 \verb+|+\dots\verb+|+，
作为方便的简写来表示 |\verb|\verb+|+\dots\verb+|+。例如，“\verb+|\mymacro|+
|\oarg{pos}| |\marg{width}| |\marg{text}|” 的排版如下：

\begin{verbatim}
    \mymacro [<pos>] {<width>} {<text>}
\end{verbatim}

与 \usemacro{verb} 类似，\verb+|+\dots\verb+|+ 简写在 \usemacro{footnote}
或其他易碎的宏中无法使用。

\indexmacroEnd{meta}
\indexmacroEnd{parg}
\indexmacroEnd{oarg}
\indexmacroEnd{marg}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{代码和评论}

\indexmacroBegin{StopEventually} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexmacroBegin{Finale}

\begin{decl}
  \defmacro{StopEventually} |{<text>}| \\
  \defmacro{Finale}
\end{decl}

该包的\index{package}源代码由 \usemacro{StopEventually}和 \usemacro{Finale}包围起来。
请注意， \usemacro{CheckSum}（第~\pageref{decl:CheckSum} 页）仅适用于该包的\index{package}源代码。
\usemacro{StopEventually}接受一个参数，即一段要在代码后排版的文本。
如果指定了 \usemacro{OnlyDescription}（第~\pageref{desc:OnlyDescription} 页），
那么 \usemacro{StopEventually}后面的内容将不会输出——包括 \usemacro{Finale}后面的文本。
因此， \usemacro{StopEventually}的 \m{text} 参数是用于提供一段无论是否排版代码都应输出的文本的机制。
通常包括参考文献部分和/或以下命令中的一个或多个。

\indexmacroEnd{Finale}
\indexmacroEnd{StopEventually}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{decl}
  \defmacro{PrintChanges} \\
  \defmacro{PrintIndex}
\end{decl}

\indexmacroBegin{PrintChanges} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{change history|(}

\usemacro{PrintChanges} 生成一个名为“变更历史”的无编号章节（见图~\vref{fig:change-history}）。
变更历史部分汇总了 \dtxfile{}文件中所有 \usemacro{changes}命令的各版本修改，这样就能轻松跟踪每个版本的变更内容。

\usemacro{PrintChanges} 使用了 \latex 的术语表机制。在 |<package>.dtx| 上运行 |latex| 会在 |<package>.glo|
中生成变更历史数据。要生成实际的变更历史（|<package>.gls|），用户应该按以下方式运行\usething{makeindex}程序：

\begin{verbatim}
    makeindex -s gglo.ist -o <package>.gls <package>.glo
\end{verbatim}

\index{change history|)}
\indexmacroEnd{PrintChanges}    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\indexmacroBegin{PrintIndex} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\index{indexing|(}

\usemacro{PrintIndex} 生成一个名为“索引”的无编号章节。索引会自动包含文档中使用、定义或描述的所有宏和环境条目。
所有环境还会额外列在“环境”下。表~\ref{tbl:index-formatting} 演示了各种条目的格式。在该表中，“27”指的是页码，
“123”指的是行号。\footnote{如果未使用 \texttt{\string\CodelineIndex}（第~\pageref{desc:CodelineIndex} 页），
  则“123”将指的是页码。} 请注意，只有在文档包含代码列表（即未指定 \usemacro{OnlyDescription}）时，
宏/环境的定义和使用才会包含在索引中。

\begin{table}[htbp]
  \centering
  \caption{Formatting of entries in the index}
  \label{tbl:index-formatting}
  \begin{tabular}{@{}llp{6cm}@{}}
    \hline
    Item        & Function           & Formatting in index                            \\
    \hline
    Macro       & Used               & |\myMacro| \dotfill~123                        \\
    Macro       & Defined            & |\myMacro| \dotfill~\underline{123}            \\
    Macro       & Described          & |\myMacro| \dotfill~\textit{27}                \\
    Environment & Defined            & |myEnv| (environment) \dotfill~\underline{123} \\
    Environment & Described          & |myEnv| (environment) \dotfill~\textit{27}     \\
    \multicolumn{2}{@{}l}{Other (\ie an explicit \texttt{\string\index})}
                & myItem \dotfill~27                                                  \\
    \hline
  \end{tabular}
\end{table}

对于显式 \usemacro{index}命令的默认格式化使用了罗马页码。这会导致混淆，因为在包源代码中罗马页码通常
表示行号。解决方案是向 \usemacro{index}命令指定``|usage|''格式化：

\begin{verbatim}
    \index{explicit indexing|usage}
\end{verbatim}

在 |<package>.dtx| 上运行 |latex| 会在 |<package>.idx| 中生成索引数据。要生成实际的索引（|<package>.ind|），
用户应该按以下方式运行\usething{makeindex}程序：

\begin{verbatim}
    makeindex -s gind.ist -o <package>.ind <package>.idx
\end{verbatim}

代码索引是文学化\index{literate programming}编程的一个很好的“附加值”。它几乎不需要额外的工作量，并
极大地帮助代码维护人员找到宏定义以及了解包\index{package}依赖的其他宏。

\index{indexing|)}
\indexmacroEnd{PrintIndex}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexthingBegin{macrocode} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{decl}
  |\begin{macrocode}| \\
    \m{code}            \\
    |\end{macrocode}|
\end{decl}

|\begin{macrocode}| 和 |\end{macrocode}| 之间列出的代码片段会原样提取到 \styfile{} 文件中。
排版时，代码片段会显示带有行号计数器，以便于指定特定行。以下是关于 \usething{macrocode} 环境的一些要点：

\begin{enumerate}
  \item ``|%|'' 和 ``|\begin{macrocode}|'' 或 ``|\end{macrocode}|'' 之间必须有\emph{精确地}四个
        空格。否则，\DOC{} 将无法检测到代码片段的结束。
        \footnote{趣闻：只有 \texttt{\string\end\string{macrocode\string}} 需要这种精确的间距，
          而且仅用于文档的排版。尽管如此，在 \texttt{\string\begin\string{macrocode\string}} 中使用
          ``\texttt{\%\textvisiblespace\textvisiblespace\textvisiblespace\textvisiblespace}''是
          个好习惯。}

  \item 在 |\begin{macrocode}|\dotsbrk|\end{macrocode}| 中的代码行不应以``|%|''开头。代码将按原样
        写入到 \insfile{} 文件中，不会删除 |%|。
\end{enumerate}

以下是一个示例代码片段。它恰好是一个完整的宏定义，但这并非必须；任何 \latex{} 代码片段都可以出现在
\usething{macrocode} 环境中。

\label{code:mymacro}
\begin{verbatim}
    %    \begin{macrocode}
    \newcommand{\mymacro}{This is
      a \LaTeX{} macro.}
    %    \end{macrocode}
\end{verbatim}

\DOC{} 将前面的代码片段格式化为以下内容：

\begin{tabbing}
  |    |\={\tiny 9} \=\kill
  \> {\tiny 1} \> |\newcommand{\mymacro}{This is| \\
  \> {\tiny 2} \> |  a \LaTeX{} macro.}|
\end{tabbing}

请注意，行号在整个程序中是唯一的（而不是在每一页顶部重置）。如果在包含前述 |\mymacro| 定义的 \dtxfile{}
文件中使用 \usemacro{PrintIndex}，索引将自动包含 |\newcommand|、|\mymacro| 和 |\LaTeX| 的条目，除非
其中任何一个被 \usemacro{DoNotIndex}排除。

\indexthingEnd{macrocode}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\indexthingBegin{macro} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\indexthingBegin{environment}

\begin{decl}
  |\begin{macro}{<macro>}| \\
    \qquad $\vdots$ \\
    |\end{macro}| \\
  \\
  |\begin{environment}{<environment>}| \\
    \qquad $\vdots$ \\
    |\end{environment}| \\
\end{decl}

\usething{macro}  和 \usething{environment} 环境用于界定完整的宏或环境定义。
\usething{macro} /\usething{environment} 环境通常包含一个或多个\usething{macrocode} 环境，其中穿插着代码文档。
以下是\usething{macrocode}示例的更完整版本，见~\vpageref{code:mymacro}。

\begin{verbatim}
    % \begin{macro}{\mymacro}
    % We define a trivial macro, |\mymacro|, to illustrate
    % the use of the |macro| environment.
    %    \begin{macrocode}
    \newcommand{\mymacro}{This is
      a \LaTeX{} macro.}
    %    \end{macrocode}
    % \end{macro}
\end{verbatim}

以下是排版后的版本：

\begin{tabbing}
  |    \mymacro|\qquad\={\tiny 9} \= \kill
  |    \mymacro| \> We define a trivial macro, |\mymacro|, to illustrate the \\
  \> use of the \usething{macro}  environment. \\
  \> {\tiny 1} \> |\newcommand{\mymacro}{This is| \\
  \> {\tiny 2} \> |  a \LaTeX{} macro.}|
\end{tabbing}

\DOC{} 在边距中排版宏/环境名称，以增加可见性。此外，\DOC{} 也会将相应条目添加到索引中
（参见表~\vref{tbl:index-formatting}，了解这些条目的格式示例）。请注意，
|\begin{macro}|\dotsbrk|\end{macro}| 不是必需的来指示宏定义。它也可以用于指示 \latex{}
数据类型的定义，例如计数器、长度和盒子：

\begin{verbatim}
    % \begin{macro}{myCounter}
    % This is an example of using the |macro| environment to format
    % something other than a macro.
    %    \begin{macrocode}
    \newcounter{myCounter}
    %    \end{macrocode}
    % \end{macro}
\end{verbatim}%
\indexthing{macrocode}

\usething{macro}  和 \usething{environment} 环境可以嵌套。这种能力不仅对于定义其他宏的宏很有用，
而且在定义一组共享描述的相关数据类型时也很有用：

\begin{verbatim}
    % \begin{macro}{\thingheight}
    % \begin{macro}{\thingwidth}
    % \begin{macro}{\thingdepth}
    % These lengths keep track of the dimensions of our |\thing|
    % box.  (Actually, we're just trying to show how to nest
    % |macro| environments.)
    %    \begin{macrocode}
    \newlength{\thingheight}
    \newlength{\thingwidth}
    \newlength{\thingdepth}
    %    \end{macrocode}
    % \end{macro}
    % \end{macro}
    % \end{macro}
\end{verbatim}%
\indexthing{macro}%
\indexthing{macrocode}

通常应避免没有描述的\usething{macro} 环境，因为格式有些丑陋；宏名称单独出现在一行上，位于一个“空白”
描述的左侧，但代码直到下一行才开始。

在|\begin{macro}|\dotsbrk|\end{macro}|或|\begin{environment}|\dotsbrk|\end{environment}|块内
可以有多个\usething{macrocode}环境。\index{comments|(} 这是代码可以被内部注释的机制，用于宏/环境。
（在\usething{macrocode}块内使用“|%|”注释被认为是不良风格。）以下是一个非平凡的宏的注释示例：

\begin{verbatim}
    % \begin{macro}{\complexMacro}
    % Pretend that this is a very complex macro that needs
    % to have its various pieces documented.
    %    \begin{macrocode}
    \newcommand{\complexMacro}{%
    %    \end{macrocode}
    % Initialize all of our counters to zero.
    %    \begin{macrocode}
      \setcounter{count@i}{0}%
      \setcounter{count@ii}{0}%
      \setcounter{count@iii}{0}%
      \setcounter{count@iv}{0}%
    %    \end{macrocode}
    % Do some really complicated processing.
    %    \begin{macrocode}
\end{verbatim}%
\indexthing{macrocode}
|                  |\textcolor{verb}{$\vdots$}
\begin{verbatim}
    %    \end{macrocode}
    % We're all finished now.
    %    \begin{macrocode}
    }
    %    \end{macrocode}
    % \end{macro}
\end{verbatim}%
\indexthing{macrocode}

\indexthingEnd{environment}
\indexthingEnd{macro}   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\index{comments|)}

附录~\ref{sec:skeleton-dtx-file-style} 列出了一个完整的、包含 \styfile{} 文件及其文档的 \dtxfile{} 文件的框架。

\index{class file|(}

\paragraph{类文件}
从 \dtxfile{}文件生成类文件的过程比生成样式文件的过程复杂得多。问题在于 \usemacro{DocInput}依赖于
|\usepackage{|\m{package}|}|行（更准确地说，依赖于\m{package}|.sty|中的 \usemacro{ProvidesPackage}行）来设置
\usemacro{fileversion}和 \usemacro{filedate}宏。然而，类文件无法使用|\usepackage|加载。我们也不能简单地用
|\documentclass{|\m{package}|}|加载，因为一个文档只能加载一个类，并且我们需要加载的类是\usething{ltxdoc}。

解决方法是使用 \usemacro{ProvidesFile}来使文件版本和日期可供 \dtxfile{}文件使用。
附录~\ref{sec:skeleton-dtx-file-class} 列出了一个完整的、包含 \clsfile{} 文件及其文档的 \dtxfile{} 文件的框架。
它类似于附录~\ref{sec:skeleton-dtx-file-style} 中展示的框架文件，但头部部分结构不同。

\index{class file|)}


\index{documented LaTeX file@documented \LaTeX{} file|)}


\section{技巧、窍门和建议}

\begin{itemize}[itemindent=2em, left= 1.5em .. .5em]
  \item 多写好文档！这确实有助于其他人理解你的代码和整个\index{package}包。

  \item 如果你认为整个 \latex{}社区都对你的包感兴趣，那么你应该将它上传到 \CTAN{}，网址是\URL{http://www.ctan.org/upload}。
        作为所有与\TeX 相关事物的中央存储库， \CTAN{}会比你个人主页上的位置更容易让其他人找到你的 \latex{}包。

        \index{documentation, prebuilt PDF|(}
  \item 在分发你的包时，务必包含一个\index{README file@\texttt{README} file}描述你的包功能的 |README| 文件，
        以及最好是作为PDF文件的\emph{预构建}文档。预构建的文档能够让用户免去下载你的包、安装它以及在了解包的功能
        或是否符合他们需求之前构建文档的麻烦。
        \index{documentation, prebuilt PDF|)}

  \item 使用 \latex 的分段命令来组织代码并澄清其结构（例如 |\subsection{|\texttt{初始化宏}|}|、
        |\subsection{|\texttt{辅助函数}|}|、|\subsection{|\texttt{导出的宏和环境}|}|，等等）。

        \index{comments|(}

  \item 虽然注释确实只属于排版文档，但也可以编写只在 \styfile{}文件中可见的注释，以及在排版文档和 \styfile{}文件中都
        可见的注释，或者只在 \dtxfile{}源文件中可见的注释。表~\ref{tbl:comment-visibility} 显示了如何控制注释的可
        见性。

        \index{comments|)}

        \begin{table}[htbp]
          \centering
          \caption{Comment visibility}
          \label{tbl:comment-visibility}
          \newcommand{\yes}{Y}%
          \newcommand{\no}{N}%
          \index{style file}%
          \index{comments}%
          \begin{tabular}{@{}ccl@{}}
            \hline
            Appears & Appears                                          \\
            in docs & in \styfile{} & \raisebox{1.5ex}[0pt]{Mechanism} \\
            \hline

            \no     & \no           & |                                % ^^A <comment>| \\[2ex]

            \no     & \yes          & |                                % \iffalse|      \\
                    &               & |                                %% <comment>|    \\
                    &               & |                                % \fi|           \\[2ex]

            \yes    & \no           & |                                % <comment>|     \\[2ex]

            \yes    & \yes          & |                                %% <comment>|    \\
            \hline
          \end{tabular}
        \end{table}

  \item 在 |<<*package>>| 和 |<</package>>| 之间的所有行（除了在\usething{macrocode}环境内的行），
        都应该以``|%|''开头。不要使用空行；这些空行会被写入到 \styfile{}文件中（而且不应该）。

        \index{package|(}
        \index{"@@\texttt{"@}!in macro names|(}
  \item 对于仅在包内部使用的宏、长度、计数器等，在其名称中使用``|@|''是个好习惯，可以声明为全局，但只打算
        在包内部使用。这样可以防止用户通过无意中重新定义包内部而破坏包状态。
        \footnote{在\LaTeX{}文档中，``|@|''被设置为类别码~12（``其他''），而不是类别码~11（``字母''），
          所以用户不能轻易地定义或使用带有``|@|''的宏。}
        另一个好习惯是为包内部的所有全局名称添加包的名称前缀（例如 ``|\<package>@thing|'' 而不是 ``|\@thing|''
        或者更糟糕的是只是 ``|\thing|''）。这有助于避免包之间的命名冲突。最后，因为十进制数字通常不允许在
        宏名称中，因此常常使用罗马数字\index{roman numerals}，例如：|\arg@i|、|\arg@ii|、|\arg@iii|、|\arg@iv|等。
        \index{"@@\texttt{"@}!in macro names|)}
        \index{package|)}

  \item 除了宏和环境之外，你可以像通常一样使用 \usemacro{index}索引其他内容。

  \item 因为宏名称可能很长，考虑使用\defthing{idxlayout}包来减少索引中的列数。（它还提供了对索引格式的其他
        方面的控制。）

  \item 如果你使用 \Emacs{} 作为文本编辑器，请尝试 \swiftexel{} 的|doctex-mode|\index{doctex-mode@\texttt{doctex-mode}}，
        这是专门用于编写 \dtxfile{} 文件的 \Emacs{} 模式。 \swiftexel{} 可以从 \CTAN{}获取。

        作为更原始的替代方法，查阅 \Emacs 的 |string-rectangle| 和 |kill-rectangle| 命令。
        这些命令对于在区域内的每一行开头添加和删除``|%|''非常有帮助。

  \item 一定要阅读《\ds{} 程序》
        \footnote{译者注：该文档可对照参阅由本人翻译的\href
          {https://github.com/rockyzhz/latexdoc-chinese-translation/blob/main/docstrip-zh-cn/docstrip-zh-cn.pdf}{中文版}。}
        和《\DOC{} 和\ \svrb{} 包》
        \footnote{译者注：该文档可对照参阅由本人翻译的\href
          {https://github.com/rockyzhz/latexdoc-chinese-translation/blob/main/doc-zh-cn/doc-code-zh-cn.pdf}{中文版}。}
        的文档，分别是\ds{} 和\DOC{} 的文档（当然是以 \dtxfile{}格式提供的）。这些文档解释了如何
        使用 \insfile{} 和 \dtxfile{} 文件进行比本教程涵盖的更高级的操作。一些高级主题包括以下内容：

        \begin{itemize}
          \item 从单个 \dtxfile{} 文件中提取多个 \styfile{} 文件。

          \item 将不同的导言放入不同的 \styfile{} 文件中。

          \item 从 \dtxfile{} 文件中提取除了 \styfile{} 文件之外的其他内容（例如配置文件或Perl脚本）。

          \item 更改排版文档的格式。
        \end{itemize}
\end{itemize}


\section{高级打包技术}

本节介绍了使用 \DOC{} 和 \ds{} 可以实现的各种高级技巧。虽然很少有包需要这些技术，但它们被包含在这里以供方便参考。

\subsection{主文档文件}
\label{sec:master-files}

\DOC{}支持包含多个 \dtxfile{}文件的“主”文档文件。其优点在于，可以使用连续的节编号和单一的统一索引对一组相关的 \dtxfile{}文件进行排版。
事实上， \latex[\LaTeXe{}]源代码本身就是使用一个主文档（|source2e.tex|）排版的，其中包含了构成 \latex[\LaTeXe{}]的众多 \dtxfile{}文件。

为了帮助生成主文档，\usething{ltxdoc}类提供了一个命令称为“ \usemacro{DocInclude}”。
\usething{ltxdoc}的 \usemacro{DocInclude}与 \DOC{} 的 \usemacro{DocInput}非常相似——它甚至在内部使用它——但具有以下附加功能。

\begin{itemize}
  \item \usemacro{PrintIndex}会被自动正确处理。

  \item 每个 \usemacro{DocInclude}的文件都会有一个标题页。

  \item \usemacro{tableofcontents}按预期工作。 \dtxfile{}文件名被用作“章节”名称。
\end{itemize}

注意，与 \usemacro{DocInput}不同， \usemacro{DocInclude}假定使用 \dtxfile{}扩展名。

附录~\ref{sec:skeleton-master-file} 提供了一个主文档的框架，使用 \usemacro{DocInclude}将
|<file1>.dtx|、|<file2>.dtx| 和 |<file3>.dtx|排版为单个文档。如果你更喜欢手动操作（例如，
如果你不喜欢 \usemacro{DocInclude}为每个文件生成标题页），你仍然可以使用 \usemacro{DocInput}。
\index{indexing|(}
只需确保重新定义 \usemacro{PrintIndex}为空操作；否则，每个文件都会有自己的索引。
在所有 \dtxfile{}文件都排版完之后，调用原始的 \usemacro{PrintIndex}命令以打印一个统一的索引：

\begin{verbatim}
    \begin{document}
      \let\origPrintIndex=\PrintIndex \let\PrintIndex=\relax
      \DocInput{<file1>.dtx}
      \DocInput{<file2>.dtx}
      \DocInput{<file3>.dtx}
      \origPrintIndex
    \end{document}
\end{verbatim}%
\indexmacro{PrintIndex}%
\indexmacro{DocInput}

\index{indexing|)}

\subsection{单文件包发布}
\label{sec:single-file}

尽管 \latex{}包通常以 \insfile{}和 \dtxfile{}文件的形式进行分发，但也可以将包作为单个文件进行分发。
关键在于在 \dtxfile{}文件的顶部，在|%<package>|行之后，包含整个 \insfile{}：

\begin{alltt}
  %\string<*batchfile\string>
  \string\begingroup
  \(\vdots\)
  <Entire contents of the {\normalfont\texttt{.ins}} file>
  \(\vdots\)
  \string\endgroup
  %\string</batchfile\string>
\end{alltt}

省略 \usemacro{endbatchfile}以允许 \latex{}继续处理 \dtxfile{}文件的其余部分。
另外，为了避免出现“\texttt{File} \m{sty-file} \texttt{already exists on the system.  Overwrite it?
[y/n]}”的消息，你可以在第一个 \usemacro{generate}命令之前加上“ \usemacro{askforoverwritefalse}”。
（这将自动覆盖现有的 \styfile{}文件。将 \usemacro{generate}命令放在
“ \usemacro{IfFileExists}|{|\m{sty-file}|}{}{|\dots|}|”中将会阻止覆盖。）
你还应该将 \styfile{}的安装说明移到 \dtxfile{}文件的末尾，这样用户就不会将其滚动到屏幕外。你需要使用
\usemacro{typeout}，因为 \usemacro{Msg}不会被定义：

\begin{verbatim}
    % \Finale
    %
    % \typeout{**************************************************}
    % \typeout{*}
    % \typeout{* To finish the installation you have to move the}
    % \typeout{* following file into a directory searched by TeX:}
    % \typeout{*}
    % \typeout{* \space\space skeleton.sty}
    % \typeout{*}
    % \typeout{* Documentation is in skeleton.dvi.}
    % \typeout{*}
    % \typeout{* Happy TeXing!}
    % \typeout{**************************************************}
    \endinput
\end{verbatim}


\subsection{具有共享版本信息的类和样式文件}

某些包包含 \clsfile{}和 \styfile{}文件。希望从同一个 \insfile{}文件中提取这两个文件，并共享相同的
版本信息字符串。《 \ds{} 程序》文档解释了如何从单个 \usemacro{generate}调用中提取多个文件：

\begin{verbatim}
    \generate{\file{<package>.cls}{\from{<package>.dtx}{class}}
              \file{<package>.sty}{\from{<package>.dtx}{package}}}
\end{verbatim}

可以通过更改附录~\ref{sec:skeleton-dtx-file-class}中显示的 \dtxfile{}文件中的以下行来为
\clsfile{}和 \styfile{}文件使用单个版本字符串：

\begin{verbatim}
    %<<class>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
    %<<class>>\ProvidesClass{<package>}
    %<<*class>>
        [<YYYY>/<MM>/<DD> v<version> <brief description>]
    %<</class>>
\end{verbatim}

替换的代码指定了哪些行属于类文件，哪些属于样式文件：

\begin{verbatim}
    %<<class|package>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
    %<<class>>\ProvidesClass{<package>}
    %<<package>>\ProvidesPackage{<package>}
    %<<*class|package>>
        [<YYYY>/<MM>/<DD> v<version> <brief description>]
    %<</class|package>>
\end{verbatim}

\subsection{高级打包技术示例集}

在 \CTAN\ \URL{https://www.ctan.org/tex-archive/info/dtxgallery}上查看 \dtxfile\
示例集，其中包括以下内容的示例：

\begin{itemize}
  \item 单文件包发布（参见第~\ref{sec:single-file}~节）

  \item 条件代码包含（参见表~\ref{tbl:comment-visibility}~）

  \item 重新排列代码以在文档中展示
\end{itemize}

\appendix

\section{框架文件}

本节包含了文档其余部分讨论的文件类型的完整框架。这些框架可以作为创建自己的包的模板。\index{package}

\index{installer file|(}

\subsection{用于生成 \texttt{.sty}文件的框架 \texttt{.ins}文件}
\label{sec:skeleton-ins-file-style}

\begin{verbatim}
%%
%% Copyright (C) <year> by <your name>
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either
%% version 1.3 of this license or (at your option) any later
%% version.  The latest version of this license is in:
%%
%%    http://www.latex-project.org/lppl.txt
%%
%% and version 1.3 or later is part of all distributions of
%% LaTeX version 2005/12/01 or later.
%%

\input docstrip.tex
\keepsilent

\usedir{tex/latex/<package>}

\preamble

This is a generated file.

Copyright (C) <year> by <your name>

This file may be distributed and/or modified under the
conditions of the LaTeX Project Public License, either
version 1.3 of this license or (at your option) any later
version.  The latest version of this license is in:

   http://www.latex-project.org/lppl.txt

and version 1.3 or later is part of all distributions of
LaTeX version 2005/12/01 or later.

\endpreamble

\generate{\file{<package>.sty}{\from{<package>.dtx}{package}}}

\Msg{*********************************************************}
\Msg{*}
\Msg{* To finish the installation you have to move the}
\Msg{* following file into a directory searched by TeX:}
\Msg{*}
\Msg{* \space\space <package>.sty}
\Msg{*}
\Msg{* To produce the documentation run the file <package>.dtx}
\Msg{* through LaTeX.}
\Msg{*}
\Msg{* Happy TeXing!}
\Msg{*********************************************************}

\endbatchfile
\end{verbatim}


\subsection{用于生成 \texttt{.cls}文件的 \texttt{.ins}框架文件}
\label{sec:skeleton-ins-file-class}

\begin{verbatim}
%%
%% Copyright (C) <year> by <your name>
%%
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either
%% version 1.3 of this license or (at your option) any later
%% version.  The latest version of this license is in:
%%
%%    http://www.latex-project.org/lppl.txt
%%
%% and version 1.3 or later is part of all distributions of
%% LaTeX version 2005/12/01 or later.
%%

\input docstrip.tex
\keepsilent

\usedir{tex/latex/<package>}

\preamble

This is a generated file.

Copyright (C) <year> by <your name>

This file may be distributed and/or modified under the
conditions of the LaTeX Project Public License, either
version 1.3 of this license or (at your option) any later
version.  The latest version of this license is in:

   http://www.latex-project.org/lppl.txt

and version 1.3 or later is part of all distributions of
LaTeX version 2005/12/01 or later.

\endpreamble

\generate{\file{<package>.cls}{\from{<package>.dtx}{class}}}

\Msg{*********************************************************}
\Msg{*}
\Msg{* To finish the installation you have to move the}
\Msg{* following file into a directory searched by TeX:}
\Msg{*}
\Msg{* \space\space <package>.cls}
\Msg{*}
\Msg{* To produce the documentation run the file <class>.dtx}
\Msg{* through LaTeX.}
\Msg{*}
\Msg{* Happy TeXing!}
\Msg{*********************************************************}

\endbatchfile
\end{verbatim}

\index{installer file|)}
\index{documented LaTeX file@documented \LaTeX{} file|(}


\subsection{用于生成 \texttt{.sty}文件的 \texttt{.dtx}框架文件}
\label{sec:skeleton-dtx-file-style}

\begin{verbatim}
% \iffalse meta-comment
%
% Copyright (C) <year> by <your name>
% -----------------------------------
%
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in:
%
%    http://www.latex-project.org/lppl.txt
%
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% \fi
%
% \iffalse
%<<package>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
%<<package>>\ProvidesPackage{<package>}
%<<package>>   [<YYYY>/<MM>/<DD> v<version> <brief description>]
%
%<<*driver>>
\documentclass{ltxdoc}
\usepackage{<package>}
\EnableCrossrefs
\CodelineIndex
\RecordChanges
\begin{document}
  \DocInput{<package>.dtx}
\end{document}
%<</driver>>
% \fi
%
% \CheckSum{0}
%
% \CharacterTable
%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%   Digits        \0\1\2\3\4\5\6\7\8\9
%   Exclamation   \!     Double quote  \"     Hash (number) \#
%   Dollar        \$     Percent       \%     Ampersand     \&
%   Acute accent  \'     Left paren    \(     Right paren   \)
%   Asterisk      \*     Plus          \+     Comma         \,
%   Minus         \-     Point         \.     Solidus       \/
%   Colon         \:     Semicolon     \;     Less than     \<<
%   Equals        \=     Greater than  \>>     Question mark \?
%   Commercial at \@     Left bracket  \[     Backslash     \\
%   Right bracket \]     Circumflex    \^     Underscore    \_
%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%   Right brace   \}     Tilde         \~}
%
%
% \changes{v1.0}{<YYYY>/<MM>/<DD>}{Initial version}
%
% \GetFileInfo{<package>.sty}
%
% \DoNotIndex{<list of control sequences>}
%
% \title{The \textsf{<package>} package\thanks{This document
%   corresponds to \textsf{<package>}~\fileversion,
%   dated \filedate.}}
% \author{<your name> \\ \texttt{<your e-mail address>}}
%
% \maketitle
%
% \begin{abstract}
%   Put text here.
% \end{abstract}
%
% \section{Introduction}
%
% Put text here.
%
% \section{Usage}
%
% \DescribeMacro{\YOURMACRO}
% Put description of |\YOURMACRO| here.
%
% \DescribeEnv{YOURENV}
% Put description of |YOURENV| here.
%
% \StopEventually{\PrintIndex}
%
% \section{Implementation}
%
% \begin{macro}{\YOURMACRO}
% Put explanation of |\YOURMACRO|'s implementation here.
%    \begin{macrocode}
\newcommand{\YOURMACRO}{}
%    \end{macrocode}
% \end{macro}
%
% \begin{environment}{YOURENV}
% Put explanation of |YOURENV|'s implementation here.
%    \begin{macrocode}
\newenvironment{YOURENV}{}{}
%    \end{macrocode}
% \end{environment}
%
% \Finale
\endinput
\end{verbatim}


\subsection{用于生成 \texttt{.cls}文件的 \texttt{.dtx}框架文件}
\label{sec:skeleton-dtx-file-class}

\begin{verbatim}
% \iffalse meta-comment
%
% Copyright (C) <year> by <your name>
% -----------------------------------
%
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in:
%
%    http://www.latex-project.org/lppl.txt
%
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% \fi
%
% \iffalse
%<<*driver>>
\ProvidesFile{<package>.dtx}
%<</driver>>
%<<class>>\NeedsTeXFormat{LaTeX2e}[2005/12/01]
%<<class>>\ProvidesClass{<package>}
%<<*class>>
    [<YYYY>/<MM>/<DD> v<version> <brief description>]
%<</class>>
%
%<<*driver>>
\documentclass{ltxdoc}
\EnableCrossrefs
\CodelineIndex
\RecordChanges
\begin{document}
  \DocInput{<package>.dtx}
\end{document}
%<</driver>>
% \fi
%
% \CheckSum{0}
%
% \CharacterTable
%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%   Digits        \0\1\2\3\4\5\6\7\8\9
%   Exclamation   \!     Double quote  \"     Hash (number) \#
%   Dollar        \$     Percent       \%     Ampersand     \&
%   Acute accent  \'     Left paren    \(     Right paren   \)
%   Asterisk      \*     Plus          \+     Comma         \,
%   Minus         \-     Point         \.     Solidus       \/
%   Colon         \:     Semicolon     \;     Less than     \<<
%   Equals        \=     Greater than  \>>     Question mark \?
%   Commercial at \@     Left bracket  \[     Backslash     \\
%   Right bracket \]     Circumflex    \^     Underscore    \_
%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%   Right brace   \}     Tilde         \~}
%
%
% \changes{v1.0}{<YYYY>/<MM>/<DD>}{Initial version}
%
% \GetFileInfo{<package>.dtx}
%
% \DoNotIndex{<list of control sequences>}
%
% \title{The \textsf{<package>} class\thanks{This document
%   corresponds to \textsf{<package>}~\fileversion,
%   dated \filedate.}}
% \author{<your name> \\ \texttt{<your e-mail address>}}
%
% \maketitle
%
% \begin{abstract}
%   Put text here.
% \end{abstract}
%
% \section{Introduction}
%
% Put text here.
%
% \section{Usage}
%
% \DescribeMacro{\YOURMACRO}
% Put description of |\YOURMACRO| here.
%
% \DescribeEnv{YOURENV}
% Put description of |YOURENV| here.
%
% \StopEventually{\PrintIndex}
%
% \section{Implementation}
%
% \begin{macro}{\YOURMACRO}
% Put explanation of |\YOURMACRO|'s implementation here.
%    \begin{macrocode}
\newcommand{\YOURMACRO}{}
%    \end{macrocode}
% \end{macro}
%
% \begin{environment}{YOURENV}
% Put explanation of |YOURENV|'s implementation here.
%    \begin{macrocode}
\newenvironment{YOURENV}{}{}
%    \end{macrocode}
% \end{environment}
%
% \Finale
\endinput
\end{verbatim}

\index{documented LaTeX file@documented \LaTeX{} file|)}

\subsection{主文档框架文件（ \texttt{.tex}）}
\label{sec:skeleton-master-file}

\begin{verbatim}
\documentclass{ltxdoc}
\usepackage{<file1>}
\usepackage{<file2>}
\usepackage{<file3>}

\title{<title>}
\author{<you>}

\EnableCrossrefs
\CodelineIndex
\RecordChanges

\begin{document}
  \maketitle

  \begin{abstract}
    <abstract>
  \end{abstract}

  \tableofcontents

  \DocInclude{<file1>}
  \DocInclude{<file2>}
  \DocInclude{<file3>}
\end{document}
\end{verbatim}


% The following was generated by BibTeX and slightly touched up by hand.
\vfill
\begin{thebibliography}{1}
  \bibitem{Goossens1994:companion}
  Michel Goossens, Frank Mittelbach, and Alexander Samarin.
  \newblock \emph{The {\LaTeX} Companion}.
  \newblock Addison~Wesley, Reading, Massachusetts, October~1, 1994.
  \newblock ISBN~\mbox{0-201-54199-8}.

  \bibitem{Knuth1984:literate}
  Donald~E. Knuth.
  \newblock Literate programming.
  \newblock \emph{The Computer Journal}, 27(2):97--111, May 1984.
  \newblock British Computer Society. Available from
  \URL{http://www.literateprogramming.com/knuthweb.pdf}.
\end{thebibliography}

% Print an index.
\index{sty@\texttt{.sty}|see{style file}}
\index{cls@\texttt{.cls}|see{class file}}
\index{ins@\texttt{.ins}|see{installer file}}
\index{dtx@\texttt{.dtx}|see{documented \LaTeX{} file}}
\index{CTAN|see{Comprehensive \TeX{} Archive Network}}
\printindex

\end{document}
